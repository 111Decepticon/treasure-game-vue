import{j as C,h as o,c as O}from"./index-9ee89850.js";const N=C("game",()=>{const u=o(null),l=o([]),s=o({}),c=o(!0),i=o(!0),m=o(!0),d=o(!1),n=o(null),V=O(()=>l.value.length/6*100),S=()=>{y.value||(y.value=new(window.AudioContext||window.webkitAudioContext))},f=a=>{if(!m.value||!d.value)return;S();const e=y.value;let t=e.createOscillator(),r=e.createGain();switch(t.connect(r),r.connect(e.destination),a){case"success":t.frequency.setValueAtTime(523.25,e.currentTime),t.frequency.setValueAtTime(659.25,e.currentTime+.1),t.frequency.setValueAtTime(783.99,e.currentTime+.2),r.gain.setValueAtTime(.3,e.currentTime),r.gain.exponentialRampToValueAtTime(.01,e.currentTime+.5),t.start(e.currentTime),t.stop(e.currentTime+.5);break;case"failure":t.frequency.setValueAtTime(392,e.currentTime),t.frequency.setValueAtTime(349.23,e.currentTime+.1),t.frequency.setValueAtTime(329.63,e.currentTime+.2),r.gain.setValueAtTime(.3,e.currentTime),r.gain.exponentialRampToValueAtTime(.01,e.currentTime+.5),t.start(e.currentTime),t.stop(e.currentTime+.5);break;case"click":t.frequency.setValueAtTime(800,e.currentTime),r.gain.setValueAtTime(.2,e.currentTime),r.gain.exponentialRampToValueAtTime(.01,e.currentTime+.1),t.start(e.currentTime),t.stop(e.currentTime+.1);break;case"complete":[523.25,659.25,783.99,1046.5].forEach((M,P)=>{setTimeout(()=>{let p=e.createOscillator(),b=e.createGain();p.connect(b),b.connect(e.destination),p.frequency.setValueAtTime(M,e.currentTime),b.gain.setValueAtTime(.3,e.currentTime),b.gain.exponentialRampToValueAtTime(.01,e.currentTime+.3),p.start(e.currentTime),p.stop(e.currentTime+.3)},P*200)});break}},A=a=>{if(!(!c.value||n.value||!d.value))try{n.value=new Audio(a),n.value.loop=!0,n.value.volume=.3,n.value.addEventListener("error",t=>{console.log("BGM加载失败:",a,t),n.value=null});const e=n.value.play();e!==void 0&&e.catch(t=>{console.log("BGM播放失败:",t),n.value=null})}catch(e){console.log("BGM错误:",e),n.value=null}},g=()=>{n.value&&(n.value.pause(),n.value.currentTime=0,n.value=null)},E=a=>{if(!i.value||!d.value)return;g();const t={library:"/audio/library-bgm.mp3",temple:"/audio/temple-bgm.mp3",cave:"/audio/cave-bgm.mp3",beach:"/audio/beach-bgm.mp3",mountain:"/audio/mountain-bgm.mp3",treasure:"/audio/treasure-bgm.mp3"}[a];t&&A(t)},T=()=>{d.value||(d.value=!0,S())},B=a=>{u.value=a},G=a=>{l.value.includes(a)||(l.value.push(a),f("success")),s.value[a]="completed",v(),l.value.length===6&&f("complete")},L=a=>{s.value[a]="failed",f("failure"),v()},h=()=>{u.value=null,l.value=[],s.value={},g(),localStorage.removeItem("treasureGameState")},v=()=>{const a={currentLocation:u.value,completedLocations:l.value,locationProgress:s.value,bgmEnabled:c.value,locationBgmEnabled:i.value,soundEffectsEnabled:m.value};localStorage.setItem("treasureGameState",JSON.stringify(a))},x=()=>{const a=localStorage.getItem("treasureGameState");if(a){const e=JSON.parse(a);u.value=e.currentLocation,l.value=e.completedLocations||[],s.value=e.locationProgress||{},c.value=e.bgmEnabled!==void 0?e.bgmEnabled:!0,i.value=e.locationBgmEnabled!==void 0?e.locationBgmEnabled:!0,m.value=e.soundEffectsEnabled!==void 0?e.soundEffectsEnabled:!0}},q=()=>{T(),c.value=!c.value,c.value?u.value?E(u.value):A("/audio/panorama-bgm.mp3"):g(),v()},w=()=>{T(),i.value=!i.value,i.value?u.value&&E(u.value):g(),v()},k=()=>{T(),m.value=!m.value,v()},y=o(null);return{currentLocation:u,completedLocations:l,locationProgress:s,bgmEnabled:c,locationBgmEnabled:i,soundEffectsEnabled:m,globalProgress:V,setCurrentLocation:B,completeLocation:G,failLocation:L,resetGame:h,saveGameState:v,loadGameState:x,playSound:f,playBgm:A,stopBgm:g,playLocationBgm:E,toggleBgm:q,toggleLocationBgm:w,toggleSoundEffects:k,markUserInteracted:T}});export{N as u};
